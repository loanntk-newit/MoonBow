!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.barba=e()}(this,function(){var t=function(){function t(){}return t.prototype.then=function(r,n){var o=new t,i=this.s;if(i){var a=1&i?r:n;if(a){try{e(o,1,a(this.v))}catch(t){e(o,2,t)}return o}return this}return this.o=function(t){try{var i=t.v;1&t.s?e(o,1,r?r(i):i):n?e(o,1,n(i)):e(o,2,i)}catch(t){e(o,2,t)}},o},t}();function e(r,n,o){if(!r.s){if(o instanceof t){if(!o.s)return void(o.o=e.bind(null,r,n));1&n&&(n=o.s),o=o.v}if(o&&o.then)return void o.then(e.bind(null,r,n),e.bind(null,r,2));r.s=n,r.v=o;var i=r.o;i&&i(r)}}function r(t,e){try{var r=t()}catch(t){return e(t)}return r&&r.then?r.then(void 0,e):r}var n={};!function(){function r(t){this.t=t,this.i=null,this.u=null,this.h=null,this.l=null}function o(t){return{value:t,done:!0}}function i(t){return{value:t,done:!1}}r.prototype[Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"))]=function(){return this},r.prototype.p=function(e){return this.u(e&&e.then?e.then(i):i(e)),this.i=new t},r.prototype.next=function(r){var i=this;return i.l=new Promise(function(a){var s=i.i;if(null===s){var u=i.t;if(null===u)return a(i.l);function c(t){i.u(t&&t.then?t.then(o):o(t)),i.i=null,i.u=null}i.t=null,i.u=a,u(i).then(c,function(e){if(e===n)c(i.h);else{var r=new t;i.u(r),i.i=null,i.u=null,_resolve(r,2,e)}})}else i.i=null,i.u=a,e(s,1,r)})},r.prototype.return=function(t){var r=this;return r.l=new Promise(function(i){var a=r.i;if(null===a)return null===r.t?i(r.l):(r.t=null,i(t&&t.then?t.then(o):o(t)));r.h=t,r.u=i,r.i=null,e(a,2,n)})},r.prototype.throw=function(t){var r=this;return r.l=new Promise(function(n,o){var i=r.i;if(null===i)return null===r.t?n(r.l):(r.t=null,o(t));r.u=n,r.i=null,e(i,2,t)})}}();var o,i,a=(function(t){var e=(o={exports:{}}).exports=function(t,e){return e=e||function(){},function(){var r=!1,n=arguments,o=new Promise(function(e,o){var i,a=t.apply({async:function(){return r=!0,function(t,r){t?o(t):e(r)}}},Array.prototype.slice.call(n));r||(!(i=a)||"object"!=typeof i&&"function"!=typeof i||"function"!=typeof i.then?e(a):a.then(e,o))});return o.then(e.bind(null,null),e),o}};e.cb=function(t,r){return e(function(){var e=Array.prototype.slice.call(arguments);return e.length===t.length-1&&e.push(this.async()),t.apply(this,e)},r)}}(),o.exports);!function(t){t[t.off=0]="off",t[t.error=1]="error",t[t.warning=2]="warning",t[t.info=3]="info",t[t.debug=4]="debug"}(i||(i={}));var s=i.off,u=function(t){this.m=t};u.getLevel=function(){return s},u.setLevel=function(t){return s=i[t]},u.prototype.print=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];this.P(console.info,i.off,t)},u.prototype.error=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];this.P(console.error,i.error,t)},u.prototype.warn=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];this.P(console.warn,i.warning,t)},u.prototype.info=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];this.P(console.info,i.info,t)},u.prototype.debug=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];this.P(console.log,i.debug,t)},u.prototype.P=function(t,e,r){e<=u.getLevel()&&t.apply(console,["["+this.m+"] "].concat(r))};var c=function(){this.logger=new u("@barba/core"),this.all=["ready","page","reset","currentAdded","currentRemoved","nextAdded","nextRemoved","beforeAppear","appear","afterAppear","appearCanceled","before","beforeLeave","leave","afterLeave","leaveCanceled","beforeEnter","enter","afterEnter","enterCanceled","after"],this.registered=new Map,this.init()};c.prototype.init=function(){var t=this;this.registered.clear(),this.all.forEach(function(e){t[e]||(t[e]=function(r,n){void 0===n&&(n=null),t.registered.has(e)||t.registered.set(e,new Set),t.registered.get(e).add({ctx:n,fn:r})})})},c.prototype.do=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];if(this.registered.has(t)){var n=Promise.resolve();return this.registered.get(t).forEach(function(t){var r=t.ctx?t.fn.bind(t.ctx):t.fn;n=n.then(function(){return a(r).apply(void 0,e)})}),n}return Promise.resolve()},c.prototype.clear=function(){var t=this;this.all.forEach(function(e){delete t[e]}),this.init()},c.prototype.help=function(){this.logger.info("Available hooks: "+this.all.join(","));var t=[];this.registered.forEach(function(e,r){return t.push(r)}),this.logger.info("Registered hooks: "+t.join(","))};var h=new c,p=function t(e,r,n){return e instanceof RegExp?function(t,e){if(!e)return t;var r=t.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)e.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return t}(e,r):Array.isArray(e)?function(e,r,n){for(var o=[],i=0;i<e.length;i++)o.push(t(e[i],r,n).source);return new RegExp("(?:"+o.join("|")+")",P(n))}(e,r,n):function(t,e,r){return E(m(t,r),e,r)}(e,r,n)},f=m,l=y,v=E,d="/",g=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function m(t,e){for(var r,n=[],o=0,i=0,a="",s=e&&e.delimiter||d,u=e&&e.whitelist||void 0,c=!1;null!==(r=g.exec(t));){var h=r[0],p=r[1],f=r.index;if(a+=t.slice(i,f),i=f+h.length,p)a+=p[1],c=!0;else{var l="",v=r[2],m=r[3],y=r[4],P=r[5];if(!c&&a.length){var E=a.length-1,x=a[E];(!u||u.indexOf(x)>-1)&&(l=x,a=a.slice(0,E))}a&&(n.push(a),a="",c=!1);var A=m||y,T=l||s;n.push({name:v||o++,prefix:l,delimiter:T,optional:"?"===P||"*"===P,repeat:"+"===P||"*"===P,pattern:A?b(A):"[^"+w(T===s?T:T+s)+"]+?"})}}return(a||i<t.length)&&n.push(a+t.substr(i)),n}function y(t){for(var e=new Array(t.length),r=0;r<t.length;r++)"object"==typeof t[r]&&(e[r]=new RegExp("^(?:"+t[r].pattern+")$"));return function(r,n){for(var o="",i=n&&n.encode||encodeURIComponent,a=0;a<t.length;a++){var s=t[a];if("string"!=typeof s){var u,c=r?r[s.name]:void 0;if(Array.isArray(c)){if(!s.repeat)throw new TypeError('Expected "'+s.name+'" to not repeat, but got array');if(0===c.length){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to not be empty')}for(var h=0;h<c.length;h++){if(u=i(c[h],s),!e[a].test(u))throw new TypeError('Expected all "'+s.name+'" to match "'+s.pattern+'"');o+=(0===h?s.prefix:s.delimiter)+u}}else if("string"!=typeof c&&"number"!=typeof c&&"boolean"!=typeof c){if(!s.optional)throw new TypeError('Expected "'+s.name+'" to be '+(s.repeat?"an array":"a string"))}else{if(u=i(String(c),s),!e[a].test(u))throw new TypeError('Expected "'+s.name+'" to match "'+s.pattern+'", but got "'+u+'"');o+=s.prefix+u}}else o+=s}return o}}function w(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function b(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function P(t){return t&&t.sensitive?"":"i"}function E(t,e,r){for(var n=(r=r||{}).strict,o=!1!==r.start,i=!1!==r.end,a=r.delimiter||d,s=[].concat(r.endsWith||[]).map(w).concat("$").join("|"),u=o?"^":"",c=0;c<t.length;c++){var h=t[c];if("string"==typeof h)u+=w(h);else{var p=h.repeat?"(?:"+h.pattern+")(?:"+w(h.delimiter)+"(?:"+h.pattern+"))*":h.pattern;e&&e.push(h),u+=h.optional?h.prefix?"(?:"+w(h.prefix)+"("+p+"))?":"("+p+")?":w(h.prefix)+"("+p+")"}}if(i)n||(u+="(?:"+w(a)+")?"),u+="$"===s?"$":"(?="+s+")";else{var f=t[t.length-1],l="string"==typeof f?f[f.length-1]===a:void 0===f;n||(u+="(?:"+w(a)+"(?="+s+"))?"),l||(u+="(?="+w(a)+"|"+s+")")}return new RegExp(u,P(r))}p.parse=f,p.compile=function(t,e){return y(m(t,e))},p.tokensToFunction=l,p.tokensToRegExp=v;var x={container:"container",namespace:"namespace",prefix:"data-barba",prevent:"prevent",wrapper:"wrapper"},A=function(){this.g=x,this.A=new DOMParser};A.prototype.toString=function(t){return t.outerHTML},A.prototype.toDocument=function(t){return this.A.parseFromString(t,"text/html")},A.prototype.toElement=function(t){var e=document.createElement("div");return e.innerHTML=t,e},A.prototype.getHtml=function(t){return void 0===t&&(t=document),this.toString(t.documentElement)},A.prototype.getWrapper=function(t){return void 0===t&&(t=document),t.querySelector("["+this.g.prefix+'="'+this.g.wrapper+'"]')},A.prototype.getContainer=function(t){return void 0===t&&(t=document),t.querySelector("["+this.g.prefix+'="'+this.g.container+'"]')},A.prototype.getNamespace=function(t){void 0===t&&(t=document);var e=t.querySelector("["+this.g.prefix+"-"+this.g.namespace+"]");return e?e.getAttribute(this.g.prefix+"-"+this.g.namespace):null},A.prototype.getHref=function(t){if(t.tagName&&"a"===t.tagName.toLowerCase()){var e=t.getAttribute("href");return e.baseVal||e}return null};var T=new A,j=function(){this.T=[]},k={current:{configurable:!0},previous:{configurable:!0}};j.prototype.add=function(t,e){this.T.push({url:t,ns:e})},j.prototype.remove=function(){this.T.pop()},j.prototype.push=function(t,e){this.add(t,e),window.history&&window.history.pushState(null,"",t)},j.prototype.cancel=function(){this.remove(),window.history&&window.history.back()},k.current.get=function(){return this.T[this.T.length-1]},k.previous.get=function(){return this.T.length<2?null:this.T[this.T.length-2]},Object.defineProperties(j.prototype,k);var L=new j,S=function(t,e){try{var r=function(){if(!e.next.html)return Promise.resolve(t).then(function(t){var r=e.next,n=e.trigger;if(t){var o=T.toElement(t);r.namespace=T.getNamespace(o),r.container=T.getContainer(o),r.html=t,"popstate"===n?L.add(r.url.href,r.namespace):L.push(r.url.href,r.namespace);var i=T.toDocument(t);document.title=i.title}})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},R=p,q={update:S,nextTick:function(){return new Promise(function(t){window.requestAnimationFrame(t)})},pathToRegexp:R},O=function(){return window.location.origin},H=function(t){var e=t||window.location.port,r=window.location.protocol;return""!==e?parseInt(e,10):"https:"===r?443:80},$=function(t){var e,r=t.replace(O(),""),n={},o=r.indexOf("#");o>=0&&(e=r.slice(o+1),r=r.slice(0,o));var i=r.indexOf("?");return i>=0&&(n=N(r.slice(i+1)),r=r.slice(0,i)),{hash:e,path:r,query:n}},N=function(t){return t.split("&").reduce(function(t,e){var r=e.split("=");return t[r[0]]=r[1],t},{})},I=function(t){return t.replace(/#.*/,"")},M={getHref:function(){return window.location.href},getOrigin:O,getPort:H,getPath:function(t){return $(t).path},parse:$,parseQuery:N,clean:I},C=function(t){if(this.j=[],"boolean"==typeof t)this.R=t;else{var e=Array.isArray(t)?t:[t];this.j=e.map(function(t){return R(t)})}};C.prototype.checkUrl=function(t){if("boolean"==typeof this.R)return this.R;var e=$(t).path;return this.j.some(function(t){return null!==t.exec(e)})};var _=function(t){function e(e){t.call(this,e),this.T=new Map}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t,e,r){return this.checkUrl(t)||this.T.set(t,{action:r,request:e}),{action:r,request:e}},e.prototype.get=function(t){return this.T.get(t)},e.prototype.getRequest=function(t){return this.T.get(t).request},e.prototype.getAction=function(t){return this.T.get(t).action},e.prototype.has=function(t){return this.T.has(t)},e.prototype.delete=function(t){return this.T.delete(t)},e.prototype.update=function(t,e){var r=Object.assign({},this.T.get(t),e);return this.T.set(t,r),r},e}(C);function U(t,e,r){return void 0===e&&(e=2e3),new Promise(function(n,o){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status)n(i.responseText);else if(i.status){var e={status:i.status,statusText:i.statusText};r(t,e),o(e)}},i.ontimeout=function(){var n=new Error("Timeout error ["+e+"]");r(t,n),o(n)},i.onerror=function(){var e=new Error("Fetch error");r(t,e),o(e)},i.open("GET",t),i.timeout=e,i.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml"),i.setRequestHeader("x-barba","yes"),i.send()})}var B=function(){return!window.history.pushState},D=function(t){return!t.el||!t.href},F=function(t){var e=t.event;return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey},W=function(t){var e=t.el;return e.hasAttribute("target")&&"_blank"===e.target},K=function(t){var e=t.el;return void 0!==e.protocol&&window.location.protocol!==e.protocol||void 0!==e.hostname&&window.location.hostname!==e.hostname},X=function(t){var e=t.el;return void 0!==e.port&&H()!==H(e.port)},G=function(t){var e=t.el;return e.getAttribute&&"string"==typeof e.getAttribute("download")},Q=function(t){return t.el.hasAttribute(x.prefix+"-"+x.prevent)},V=function(t){return Boolean(t.el.closest("["+x.prefix+"-"+x.prevent+'="all"]'))},z=function(t){return I(t.href)===I(window.location.href)},J=function(t){function e(e){t.call(this,e),this.suite=[],this.tests=new Map,this.init()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.init=function(){this.add("pushState",B),this.add("exists",D),this.add("newTab",F),this.add("blank",W),this.add("corsDomain",K),this.add("corsPort",X),this.add("download",G),this.add("preventSelf",Q),this.add("preventAll",V),this.add("sameUrl",z,!1)},e.prototype.add=function(t,e,r){void 0===r&&(r=!0),this.tests.set(t,e),r&&this.suite.push(t)},e.prototype.run=function(t,e,r,n){return this.tests.get(t)({el:e,event:r,href:n})},e.prototype.checkLink=function(t,e,r){var n=this;return this.suite.some(function(o){return n.run(o,t,e,r)})},e}(C),Y=function(t){void 0===t&&(t=[]),this.logger=new u("@barba/core"),this.all=[],this.appear=[],this.k=[{name:"namespace",type:"strings"},{name:"custom",type:"function"}],t&&(this.all=this.all.concat(t)),this.update()};Y.prototype.add=function(t,e){switch(t){case"rule":this.k.splice(e.position||0,0,e.value);break;case"transition":default:this.all.push(e)}this.update()},Y.prototype.resolve=function(t,e){var r,n=this;void 0===e&&(e={});var o=e.appear?this.appear:this.all;o=o.filter(e.self?function(t){return t.name&&"self"===t.name}:function(t){return!t.name||"self"!==t.name});var i=new Map,a=o.find(function(r){var o=!0,a={};return!(!e.self||"self"!==r.name)||(n.k.reverse().forEach(function(i){o&&(o=n.O(r,i,t,a),e.appear||(r.from&&r.to&&(o=n.O(r,i,t,a,"from")&&n.O(r,i,t,a,"to")),r.from&&!r.to&&(o=n.O(r,i,t,a,"from")),!r.from&&r.to&&(o=n.O(r,i,t,a,"to"))))}),i.set(r,a),o)}),s=i.get(a),u=[];if(u.push(e.appear?"appear":"page"),e.self&&u.push("self"),s){var c=[a];Object.keys(s).length>0&&c.push(s),(r=this.logger).info.apply(r,["Transition found ["+u.join(",")+"]"].concat(c))}else this.logger.info("No transition found ["+u.join(",")+"]");return a},Y.prototype.update=function(){var t=this;this.all=this.all.map(function(e){return t.L(e)}).sort(function(t,e){return t.priority-e.priority}).reverse().map(function(t){return delete t.priority,t}),this.appear=this.all.filter(function(t){return void 0!==t.appear})},Y.prototype.O=function(t,e,r,n,o){var i=!0,a=!1,s=t,u=e.name,c=u,h=u,p=u,f=o?s[o]:s,l="to"===o?r.next:r.current;if(o?f&&f[u]:f[u]){switch(e.type){case"strings":default:var v=Array.isArray(f[c])?f[c]:[f[c]];l[c]&&-1!==v.indexOf(l[c])&&(a=!0),-1===v.indexOf(l[c])&&(i=!1);break;case"object":var d=Array.isArray(f[h])?f[h]:[f[h]];l[h]&&(l[h].name&&-1!==d.indexOf(l[h].name)&&(a=!0),-1===d.indexOf(l[h].name)&&(i=!1));break;case"function":f[p](r)?a=!0:i=!1}a&&(o?(n[o]=n[o]||{},n[o][u]=s[o][u]):n[u]=s[u])}return i},Y.prototype.M=function(t,e,r){var n=0;return(t[e]||t.from&&t.from[e]||t.to&&t.to[e])&&(n+=Math.pow(10,r),t.from&&t.from[e]&&(n+=1),t.to&&t.to[e]&&(n+=2)),n},Y.prototype.L=function(t){var e=this;t.priority=0;var r=0;return this.k.forEach(function(n,o){r+=e.M(t,n.name,o+1)}),t.priority=r,t};var Z=function(t){void 0===t&&(t=[]),this.logger=new u("@barba/core"),this.S=!1,this.store=new Y(t)},tt={isRunning:{configurable:!0},hasAppear:{configurable:!0},hasSelf:{configurable:!0},shouldWait:{configurable:!0}};Z.prototype.get=function(t,e){return this.store.resolve(t,e)},tt.isRunning.get=function(){return this.S},tt.isRunning.set=function(t){this.S=t},tt.hasAppear.get=function(){return this.store.appear.length>0},tt.hasSelf.get=function(){return this.store.all.some(function(t){return"self"===t.name})},tt.shouldWait.get=function(){return this.store.all.some(function(t){return t.to&&!t.to.route||t.sync})},Z.prototype.doAppear=function(t){var e=t.data,n=t.transition;try{var o=this;function i(t){o.S=!1}var a=n||{};o.S=!0;var s=r(function(){return Promise.resolve(o.$("beforeAppear",e,a)).then(function(){return Promise.resolve(o.appear(e,a)).then(function(){return Promise.resolve(o.$("afterAppear",e,a)).then(function(){})})})},function(t){throw o.S=!1,o.logger.error(t),new Error("Transition error [appear]")});return s&&s.then?s.then(i):i()}catch(t){return Promise.reject(t)}},Z.prototype.doPage=function(t){var e=t.data,n=t.transition,o=t.page,i=t.wrapper;try{var a=this;function s(t){a.S=!1}var u=n||{},c=!0===u.sync||!1;a.S=!0;var h=r(function(){function t(){return Promise.resolve(a.$("before",e,u)).then(function(){function t(t){return Promise.resolve(a.$("after",e,u)).then(function(){return Promise.resolve(a.remove(e)).then(function(){})})}var n=function(){if(c)return r(function(){return Promise.resolve(a.add(e,i)).then(function(){return Promise.resolve(a.$("beforeLeave",e,u)).then(function(){return Promise.resolve(a.$("beforeEnter",e,u)).then(function(){return Promise.resolve(Promise.all([a.leave(e,u),a.enter(e,u)])).then(function(){return Promise.resolve(a.$("afterLeave",e,u)).then(function(){return Promise.resolve(a.$("afterEnter",e,u)).then(function(){})})})})})})},function(){throw new Error("Transition error [page][sync]")});{function t(t){return r(function(){var t=function(){if(!1!==n)return Promise.resolve(a.add(e,i)).then(function(){return Promise.resolve(a.$("beforeEnter",e,u)).then(function(){return Promise.resolve(a.enter(e,u,n)).then(function(){return Promise.resolve(a.$("afterEnter",e,u)).then(function(){})})})})}();if(t&&t.then)return t.then(function(){})},function(){throw new Error("Transition error [page][enter]")})}var n=!1,s=r(function(){return Promise.resolve(a.$("beforeLeave",e,u)).then(function(){return Promise.resolve(Promise.all([a.leave(e,u),S(o,e)]).then(function(t){return t[0]})).then(function(t){return n=t,Promise.resolve(a.$("afterLeave",e,u)).then(function(){})})})},function(){throw new Error("Transition error [page][leave]")});return s&&s.then?s.then(t):t()}}();return n&&n.then?n.then(t):t()})}var n=function(){if(c)return Promise.resolve(S(o,e)).then(function(){})}();return n&&n.then?n.then(t):t()},function(t){throw a.S=!1,a.logger.error(t),new Error("Transition error")});return h&&h.then?h.then(s):s()}catch(t){return Promise.reject(t)}},Z.prototype.appear=function(t,e){try{return Promise.resolve(h.do("appear",t,e)).then(function(){return e.appear?a(e.appear)(t):Promise.resolve()})}catch(t){return Promise.reject(t)}},Z.prototype.leave=function(t,e){try{return Promise.resolve(h.do("leave",t,e)).then(function(){return e.leave?a(e.leave)(t):Promise.resolve()})}catch(t){return Promise.reject(t)}},Z.prototype.enter=function(t,e,r){try{return Promise.resolve(h.do("enter",t,e)).then(function(){return e.enter?a(e.enter)(t,r):Promise.resolve()})}catch(t){return Promise.reject(t)}},Z.prototype.add=function(t,e){try{e.appendChild(t.next.container),h.do("nextAdded",t)}catch(t){return Promise.reject(t)}},Z.prototype.remove=function(t){try{var e=t.current.container;document.body.contains(e)&&(e.parentNode.removeChild(e),h.do("currentRemoved",t))}catch(t){return Promise.reject(t)}},Z.prototype.$=function(t,e,r){try{return Promise.resolve(h.do(t,e,r)).then(function(){return r[t]?a(r[t])(e):Promise.resolve()})}catch(t){return Promise.reject(t)}},Object.defineProperties(Z.prototype,tt);var et=function(t){var e=this;this.names=["beforeAppear","afterAppear","beforeLeave","afterLeave","beforeEnter","afterEnter"],this.byNamespace=new Map,0!==t.length&&(t.forEach(function(t){e.byNamespace.set(t.namespace,t)}),this.names.forEach(function(t){h[t](e.q(t),e)}),h.ready(this.q("beforeEnter"),this))};et.prototype.q=function(t){var e=this;return function(r){var n=t.match(/enter/i)?r.next:r.current,o=e.byNamespace.get(n.namespace);o&&o[t]&&o[t](r)}},Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null});var rt={container:void 0,html:void 0,namespace:void 0,url:{hash:void 0,href:void 0,path:void 0,query:{}}},nt=function(){this.version="2.3.12",this.schemaPage=rt,this.Logger=u,this.logger=new u("@barba/core"),this.plugins=[],this.hooks=h,this.dom=T,this.helpers=q,this.history=L,this.request=U,this.url=M},ot={data:{configurable:!0},wrapper:{configurable:!0}};return nt.prototype.use=function(t,e){var r=this.plugins;r.indexOf(t)>-1?this.logger.warn("Plugin ["+t.name+"] already installed."):"function"==typeof t.install?(t.install(this,e),r.push(t)):this.logger.warn("Plugin ["+t.name+'] has no "install" method.')},nt.prototype.init=function(t){void 0===t&&(t={});var e=t.transitions;void 0===e&&(e=[]);var r=t.views;void 0===r&&(r=[]);var n=t.prevent;void 0===n&&(n=null);var o=t.timeout;void 0===o&&(o=2e3);var i=t.requestError,a=t.cacheIgnore;void 0===a&&(a=!1);var s=t.prefetchIgnore;void 0===s&&(s=!1);var c=t.schema;void 0===c&&(c=x);var h=t.debug;void 0===h&&(h=!1);var p=t.logLevel;if(void 0===p&&(p="off"),u.setLevel(!0===h?"debug":p),this.logger.print(this.version),Object.keys(c).forEach(function(t){x[t]&&(x[t]=c[t])}),this.C=i,this.timeout=o,this.cacheIgnore=a,this.prefetchIgnore=s,this.B=this.dom.getWrapper(),!this.B)throw new Error("[@barba/core] No Barba wrapper found");this.B.setAttribute("aria-live","polite"),this.H();var f=this.data.current;if(!f.container)throw new Error("[@barba/core] No Barba container found");if(this.cache=new _(a),this.prevent=new J(s),this.transitions=new Z(e),this.views=new et(r),null!==n){if("function"!=typeof n)throw new Error("[@barba/core] Prevent should be a function");this.prevent.add("preventCustom",n)}this.history.add(f.url.href,f.namespace),this.I=this.I.bind(this),this.N=this.N.bind(this),this.U=this.U.bind(this),this.D(),this.plugins.forEach(function(t){return t.init()});var l=this.data;l.trigger="barba",l.next=l.current,this.hooks.do("ready",l),this.appear(),this.H()},nt.prototype.destroy=function(){this.H(),this.X(),this.hooks.clear(),this.plugins=[]},ot.data.get=function(){return this._},ot.wrapper.get=function(){return this.B},nt.prototype.force=function(t){window.location.assign(t)},nt.prototype.go=function(t,e,r){var n;if(void 0===e&&(e="barba"),!(n="popstate"===e?this.history.current&&this.url.getPath(this.history.current.url)===this.url.getPath(t):this.prevent.run("sameUrl",null,null,t))||this.transitions.hasSelf)return r&&(r.stopPropagation(),r.preventDefault()),this.page(t,e,n)},nt.prototype.appear=function(){try{var t=this,e=function(){if(t.transitions.hasAppear){var e=r(function(){var e=t._,r=t.transitions.get(e,{appear:!0});return Promise.resolve(t.transitions.doAppear({transition:r,data:e})).then(function(){})},function(e){t.logger.error(e)});if(e&&e.then)return e.then(function(){})}}();return e&&e.then?e.then(function(){}):void 0}catch(t){return Promise.reject(t)}},nt.prototype.page=function(t,e,n){try{var o=this;function i(){var t=o.data;return Promise.resolve(o.hooks.do("page",t)).then(function(){var e=r(function(){var e=o.transitions.get(t,{appear:!1,self:n});return Promise.resolve(o.transitions.doPage({data:t,page:a,transition:e,wrapper:o.B})).then(function(){o.H()})},function(t){o.logger.error(t)});if(e&&e.then)return e.then(function(){})})}if(o.transitions.isRunning)return void o.force(t);o.data.next.url=Object.assign({},{href:t},o.url.parse(t)),o.data.trigger=e;var a=o.cache.has(t)?o.cache.update(t,{action:"click"}).request:o.cache.set(t,o.request(t,o.timeout,o.onRequestError.bind(o,e)),"click").request,s=function(){if(o.transitions.shouldWait)return Promise.resolve(S(a,o.data)).then(function(){})}();return s&&s.then?s.then(i):i()}catch(t){return Promise.reject(t)}},nt.prototype.onRequestError=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];this.transitions.isRunning=!1;var n=e[0],o=e[1],i=this.cache.getAction(n);return this.cache.delete(n),!(this.C&&!1===this.C(t,i,n,o)||("click"===i&&this.force(n),1))},nt.prototype.prefetch=function(t){var e=this;this.cache.has(t)||this.cache.set(t,this.request(t,this.timeout,this.onRequestError.bind(this,"barba")).catch(function(t){e.logger.error(t)}),"prefetch")},nt.prototype.D=function(){!0!==this.prefetchIgnore&&(document.addEventListener("mouseover",this.I),document.addEventListener("touchstart",this.I)),document.addEventListener("click",this.N),window.addEventListener("popstate",this.U)},nt.prototype.X=function(){!0!==this.prefetchIgnore&&(document.removeEventListener("mouseover",this.I),document.removeEventListener("touchstart",this.I)),document.removeEventListener("click",this.N),window.removeEventListener("popstate",this.U)},nt.prototype.I=function(t){var e=this,r=this.F(t);if(r){var n=this.dom.getHref(r);this.prevent.checkUrl(n)||this.cache.has(n)||this.cache.set(n,this.request(n,this.timeout,this.onRequestError.bind(this,r)).catch(function(t){e.logger.error(t)}),"enter")}},nt.prototype.N=function(t){var e=this.F(t);e&&this.go(this.dom.getHref(e),e,t)},nt.prototype.U=function(){this.go(this.url.getHref(),"popstate")},nt.prototype.F=function(t){for(var e=t.target;e&&!this.dom.getHref(e);)e=e.parentNode;if(e&&!this.prevent.checkLink(e,t,this.dom.getHref(e)))return e},nt.prototype.H=function(){var t=this.url.getHref(),e={container:this.dom.getContainer(),html:this.dom.getHtml(),namespace:this.dom.getNamespace(),url:Object.assign({},{href:t},this.url.parse(t))};this._={current:e,next:Object.assign({},this.schemaPage),trigger:void 0},this.hooks.do("reset",this.data)},Object.defineProperties(nt.prototype,ot),new nt});